<%= form_with url: mypage_users_path, local: true, method: :put do |f| %>

  <div class="container">
    <div class="card-container">
      <div class="card-body">
          <h3 class="card-title text-center mb-4 mt-1">会員情報の編集</h3>
          <hr>
          <form>

            <div class="form-group">
              <div class="input-group d-flex justify-content-between">
                <div class="input-group-prepend">
                  <span class="input-group-text"> 
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                      <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                    </svg>
                  </span>
                </div>

                <div class="collapse show userUsername m-1">
                  <h6><%= @user.username %></h6>
                </div>

                <div class="collapse editUserUsername">
                  <div class="d-flex flex-row">

                      <%= 
                      f.text_field :username, 
                      class: "form-control #{"is-invalid" if @user.errors.messages[:username].present? } ", 
                      value: @user.username, 
                      autofocus: "true",
                      required: "",
                      placeholder: "ユーザーネームを入力"
                      %>

                      <%= f.submit "保存", class: "btn btn-primary btn-sm ml-2" %>


                      <% if @user.errors.messages[:username].present? %>
                      <span class="invalid-feedback" role="alert">
                        <strong>ユーザーネームを入力してください</strong>
                      </span>
                      <% end %>

                  </div>
                </div>

                <span onclick="switchEditUserInfo('.userUsername','.editUserUsername','.userUsernameEditLabel')"; class="userUsernameEditLabel center btn btn-secondary btn-sm">
                  編集
                </span>

              </div> 
            </div>

            <div class="form-group">
              <div class="input-group d-flex justify-content-between">
                <div class="input-group-prepend">
                  <span class="input-group-text"> 
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
                      <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383l-4.758 2.855L15 11.114v-5.73zm-.034 6.878L9.271 8.82 8 9.583 6.728 8.82l-5.694 3.44A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.739zM1 11.114l4.758-2.876L1 5.383v5.73z"/>
                    </svg>                  
                  </span>
                </div>

                <div class="collapse show userEmail m-1">
                  <h6><%= @user.email %></h6>
                </div>

                <div class="collapse editUserEmail">
                  <div class="d-flex flex-row">

                      <%= 
                      f.email_field :email, 
                      class: "form-control #{"is-invalid" if @user.errors.messages[:email].present? } ", 
                      value: @user.email, 
                      autofocus: "true",
                      required: "",
                      placeholder: "メールアドレスを入力"
                      %>

                      <%= f.submit "保存", class: "btn btn-primary btn-sm ml-2" %>


                      <% if @user.errors.messages[:email].present? %>
                      <span class="invalid-feedback" role="alert">
                        <strong>メールアドレスを入力してください</strong>
                      </span>
                      <% end %>

                  </div>
                </div>
                
                <span onclick="switchEditUserInfo('.userEmail','.editUserEmail','.userEmailEditLabel')"; class="userEmailEditLabel center btn btn-secondary btn-sm">
                  編集
                </span>

              </div>
            </div>

            <div class="form-group">
              <div class="input-group d-flex justify-content-between">
                <div class="input-group-prepend">
                  <span class="input-group-text"> 
                    <i class="fa-solid fa-earth-asia"></i>
                  </span>
                </div>

                <div class="collapse show userPlace m-1">
                  <h6><%= Place.find(@user.place_id).prefecture %></h6>
                </div>

                <div class="collapse editUserPlace">
                  <div class="d-flex flex-row">
                    <div class="prefecture-select">
                      <%= f.collection_select(:place_id, @places, :id, :prefecture, {selected: @user.place_id}) %>
                    </div>


                    <%= f.submit "保存", class: "btn btn-primary btn-sm ml-2" %>


                    <% if @user.errors.messages[:place_id].present? %>
                    <span class="invalid-feedback" role="alert">
                      <strong>メールアドレスを入力してください</strong>
                    </span>
                    <% end %>

                  </div>
                </div>

                <span onclick="switchEditUserInfo('.userPlace','.editUserPlace','.userPlaceEditLabel')"; class="userPlaceEditLabel center btn btn-secondary btn-sm">
                  編集
                </span>



              </div> 
            </div>

          </form>
      </div>
    </div>
  </div>
<% end %>

<hr>

<div class="container">
  <div class="card-container">
    <div class="card-body">
        <h3 class="card-title text-center mb-4 mt-1">退会お手続き</h3>
        <hr>

        <div class="form-group">
          <div class="input-group">
            <p>
              退会手続きをされますと、全てのサービスがご利用いただけなくなります。<br>
              再度ご利用をいただく場合には、新規登録のお手続きが必要になります。<br>
              本当に退会してよろしいですか？
            </p>
          </div> 
        </div>

        <div class="form-group">
          <%= link_to "退会する", withdrawal_users_path, method: :patch, class:"btn btn-outline-secondary btn-block" %>

        </div> 

    </div>
  </div>
</div>


<script type = "text/javascript">

let switchEditUserInfo = (textClass, inputClass, labelClass) => {
  if($(textClass).css('display')=='block'){
    $(labelClass).text("キャンセル");
    $(textClass).collapse('hide');
    $(inputClass).collapse('show');
  }else{
    $(labelClass).text("編集");
    $(textClass).collapse('show');
    $(inputClass).collapse('hide');
  }
}

</script>
